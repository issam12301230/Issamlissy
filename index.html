<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>موقعي الشخصي - أخبار وفعاليات</title>
<style>
body { font-family:'Arial',sans-serif; background: linear-gradient(135deg,#00ff99,#006622); color:#fff; padding:20px; margin:0; }
header { text-align:center; padding:20px; background: rgba(0,0,0,0.3); border-radius:15px; margin-bottom:20px; }
header a { color:#fff; font-weight:bold; text-decoration:none; }
.post-container { display:flex; flex-direction:column; align-items:center; }
.post { background: rgba(0,0,0,0.5); padding:15px; margin:10px; border-radius:15px; position:relative; }
.post img { max-width:100%; border-radius:10px; margin-top:5px; }
button { padding:5px 10px; margin-top:5px; border-radius:5px; cursor:pointer; border:none; font-weight:bold; background:#00ff99; color:#006622; transition:0.3s; }
button:hover{ transform: scale(1.1); box-shadow:0 0 10px #0f0; }
#viewerBox { position:fixed; bottom:20px; left:20px; background: rgba(0,0,0,0.5); padding:10px; border-radius:10px; text-align:left; }
</style>
</head>
<body>

<header>
<h1>موقع الأخبار والمعلومات والفعاليات</h1>
<p>أخبار، معلومات، أحداث، مظاهرات، مقالب ...</p>
<p style="color:#ff0;">تحذير: أي منشور مسيء يمكن الإبلاغ عنه.</p>
<p>حسابي على إنستاغرام: <a href="https://www.instagram.com/1x_x.issam.x_x5" target="_blank">@1x_x.issam.x_x5</a></p>
</header>

<div class="post-container" id="postsContainer"></div>

<div id="viewerBox">
    <div>الإجمالي الذين دخلوا الموقع: <span id="totalViewers">0</span></div>
    <div>المشاهدون الحاليون: <span id="currentViewers">0</span></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAYYHodH9RefC7ToNj4SI3nFAtOc6B36CU",
  authDomain: "issam-b3280.firebaseapp.com",
  projectId: "issam-b3280",
  storageBucket: "issam-b3280.firebasestorage.app",
  messagingSenderId: "767266617594",
  appId: "1:767266617594:web:4b04e0aeffe4ccc0903143",
  measurementId: "G-FVZEEHQYGL"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let totalViewers = parseInt(localStorage.getItem('totalViewers') || '0');
let currentViewers = parseInt(localStorage.getItem('currentViewers') || '0');
totalViewers++; currentViewers++;
localStorage.setItem('totalViewers', totalViewers);
localStorage.setItem('currentViewers', currentViewers);
document.getElementById('totalViewers').innerText = totalViewers;
document.getElementById('currentViewers').innerText = currentViewers;
window.addEventListener('beforeunload', ()=>{ currentViewers--; if(currentViewers<0) currentViewers=0; localStorage.setItem('currentViewers', currentViewers); });

const postsContainer = document.getElementById('postsContainer');
const q = query(collection(db,'posts'), orderBy('time','desc'));
onSnapshot(q,(snapshot)=>{
  postsContainer.innerHTML='';
  snapshot.forEach(doc=>{
    const post = doc.data();
    const div = document.createElement('div'); div.className='post';
    div.innerHTML=`<b>${post.user}</b>: ${post.text}${post.img? `<br><img src="${post.img}">` : ''}`;
    const reportBtn = document.createElement('button'); reportBtn.innerText='إبلاغ';
    reportBtn.onclick = async ()=>{
      const reason = prompt('اكتب سبب الإبلاغ عن هذا المنشور:');
      if(reason){
        await addDoc(collection(db,'reports'), {postUser:post.user,text:post.text,reason,time:Date.now()});
        alert('تم إرسال البلاغ!');
      }
    }
    div.appendChild(reportBtn);
    postsContainer.appendChild(div);
  });
});
</script>

</body>
</html>
